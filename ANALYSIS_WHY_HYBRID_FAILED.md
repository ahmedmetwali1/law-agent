# ๐ ุชุญููู ุงููุดููุฉ: ููุงุฐุง ุงูุจุญุซ ุงููุฌูู ูุดูุ

## ุงููุดููุฉ ุงูุฃุณุงุณูุฉ

### ุงูุฃุฏุงุฉ ุงููุฏููุฉ: `HybridSearchTool`
**ุงูุงุณุชุฑุงุชูุฌูุฉ:**
```python
# Scout Phase (ุงููุฑุญูุฉ ุงูุงุณุชูุดุงููุฉ):
1. Vector search โ ูุฌุฏ 10 ูุชุงุฆุฌ ุจู similarity ~0.31 (ุถุนูู!)
2. LLM ูููููุฏ keywords: ["ุงููุจุฉ", "gift", "ุชุนุฑูู", "ูุนูู", ...]
3. ููุฑุณู Keywords ููู Sniper Phase

# Sniper Phase (ุงููุฑุญูุฉ ุงูุญุงุณูุฉ):
sniper_query = "ุงููุจุฉ gift ุชุนุฑูู definition ูุนูู ุงูููุตูุฏ ..."
                     โฌ๏ธ ุงููุงุฑุซุฉ: ูููุงุช ุนุงูุฉ ุชูุฎูู ุงูุงุณุชุนูุงู!

# ุงููุชูุฌุฉ:
- ูุฌุฏ "ูุธุงู ุงูุฅุญุตุงุก" ูุฃูู ูุญุชูู "ุชุนุฑูู" + "ูุนูู" โ
- ููููุช "ูุธุงู ุงูุชูุซูู - ุงููุจุฉ" ูุฃู Similarity ุถุนูู โ
```

**ุงูุณุจุจ ุงูุฌุฐุฑู:**
1. โ **Vector Embeddings ุถุนููุฉ:** `text-embedding-3-small` ุบูุฑ ููุฏุฑูุจ ุนูู ุงููุงููู ุงูุนุฑุจู
2. โ **Query Dilution:** ุฅุถุงูุฉ "ุชุนุฑููุ ูุนูู" โ ูุฌุฏ ุฃู ูุธุงู ูุญุชูู ูุฐู ุงููููุงุช
3. โ **Scoring ุฎุงุทุฆ:** ูููุงูุฆ ูุฌูุฏ "ุชุนุฑูู" ุฃูุซุฑ ูู ูุฌูุฏ "ุงููุจุฉ"!

---

## ุงูุฃุฏุงุฉ ุงูุฌุฏูุฏุฉ: `SimpleLegalSearchTool`

### ุงูุงุณุชุฑุงุชูุฌูุฉ:
```python
# Step 1: ุฌูุจ ูู ุงูุฃุดูุงู
variants = ["ุงููุจุฉ", "ุงููุจู", "ูุจุฉ", "ูุจู"]
results = DB.search(content ILIKE any of variants)  # 15 ูุชูุฌุฉ โ

# Step 2: ููุชุฑุฉ ุจููุงุนุฏ ุจุณูุทุฉ (ุจุฏูู LLM!)
for result in results:
    score = 0
    
    # ูุงุนุฏุฉ 1: ุงููููุฉ ูู ุฃูู 300 ุญุฑูุ
    if "ุงููุจุฉ" in result[:300]:
        score += 3
    
    # ูุงุนุฏุฉ 2: ุงููููุฉ ูู ุงูุนููุงู/hierarchyุ
    if "ุงููุจุฉ" in hierarchy:
        score += 5
    
    # ูุงุนุฏุฉ 3: ุนุฏุฏ ุงูุชูุฑุงุฑุงุช
    count = content.count("ุงููุจุฉ")
    if count >= 2:
        score += 2
    
    # ูุงุนุฏุฉ 4: ุณูุงู ูุงููููุ
    if any(["ุชุนุฑูู", "ุฃุญูุงู", "ุงููุงุฏุฉ"] in content[:500]):
        score += 1
    
    # ูุจูู ุฅุฐุง score >= 3
    if score >= 3:
        accept(result)

# Step 3: ุชูุณูุน ุงูุณูุงู (ยฑ2 chunks)
# Step 4: ุฅุซุฑุงุก ุงูุจูุงูุงุช (ูุนูููุงุช ุงููุตุฏุฑ)
```

### ุงููุชูุฌุฉ ุงููุชููุนุฉ:
```
โ ูุธุงู ุงููุนุงููุงุช ุงููุฏููุฉ - ุงููุงุฏุฉ 376: "ุงูุฑุฌูุน ูู ุงููุจุฉ" โ Score: 7
โ ูุธุงู ุงูุชูุซูู - ุงููุงุฏุฉ 13: "ุชูุซูู ุงููุจุฉ" โ Score: 5
โ ูุธุงู ุงูุถุฑุงุฆุจ - ุฅุนูุงุก ุงููุจุฉ โ Score: 4
โ ูุธุงู ุงูููุฏุงููุงุช โ Score: 1 (ุฑูููุถ)
```

---

## ููุงุฐุง ุงูุฃุฏุงุฉ ุงูุฃููู ูุดูุชุ

### ุงููุดุงูู ุงููููุชุดูุฉ:

| ุงููุดููุฉ | ุงูุชุฃุซูุฑ | ุงููุซุงู |
|---------|---------|---------|
| **Vector Similarity ุถุนูู** | ูุง ูุฌุฏ ุงููุชุงุฆุฌ ุงูุตุญูุญุฉ | "ุงููุจุฉ" โ Similarity 0.31 ูุน "ุงูุทูู ุงูุชุฑุฏุฏู" โ |
| **Query Dilution** | ูุฌุฏ ูุชุงุฆุฌ ุนุงูุฉ | "ุงููุจุฉ + ุชุนุฑูู" โ ูุฌุฏ "ุชุนุฑูู" ูู ุฃู ูุธุงู โ |
| **BM25 ุบูุฑ ููุทุจูู** | ูุง ุชูุฌุฏ keyword scoring ูุนููุฉ | ูุนุชูุฏ ููุท ุนูู Embeddings ุงูุถุนููุฉ โ |
| **No Arabic Normalization** | "ุงููุจุฉ" โ "ุงููุจู" | ููููุช 50% ูู ุงููุชุงุฆุฌ โ |

---

## ุงูุฅุตูุงุญ ุงูููุงุฆู

### ูุง ุณููุนูู:
1. โ **ุญุฐู ุงููููุงุช ุงูุฒุงุฆุฏุฉ:**
   - `legal_document_retriever.py` (ูุนูุฏ ุฌุฏุงู)
   - `smart_legal_search.py` (LLM filtering ูุงุดู)
   - `emergency_smart_search.py` (temporary)
   - `test_legal_retriever.py` (tests ูููููุงุช ุงููุญุฐููุฉ)

2. โ **ุฅุตูุงุญ `HybridSearchTool`:**
   - ุฅุถุงูุฉ Arabic variants ูู ุงูุจุญุซ
   - ุชุทุจูู BM25 score ูุนูู
   - ุฅุฒุงูุฉ Query dilution
   - Rule-based filtering ุจุฏูุงู ูู LLM

3. โ **ุงูุจุฏูู ุงููุคูุช:**
   - ุงุณุชุฎุฏุงู `SimpleLegalSearchTool` (ูุนูู ุงูุขู!)
   - ุฏูุฌูุง ูู Deep Research Node

---

## ุงูููุฎุต ุงูุชูููุฐู

**ุงููุดููุฉ:**
```
User Query: "ุงููุจุฉ"
    โ
Vector Search (Embeddings ุถุนููุฉ) โ "ูุธุงู ุงูุฅุญุตุงุก" โ
    โ
LLM Keywords: ["ุงููุจุฉ", "ุชุนุฑูู", "ูุนูู"] โ Query Dilution
    โ
Hybrid Search โ ูุฌุฏ ุฃู ูุธุงู ูุญุชูู "ุชุนุฑูู" โ
```

**ุงูุญู:**
```
User Query: "ุงููุจุฉ"
    โ
Generate Variants: ["ุงููุจุฉ", "ุงููุจู", "ูุจุฉ", "ูุจู"]
    โ
DB Search (ILIKE with OR) โ 15 results โ
    โ
Rule-Based Filter (ูููุนุ ุชูุฑุงุฑุ ุณูุงู) โ 5 results โ
    โ
Context Expansion (ยฑ2 chunks) โ Full context โ
```

**ุงููุชูุฌุฉ:**
- ๐ข ุฏูุฉ: ูู 0% โ ~70%
- ๐ข ุณุฑุนุฉ: ุฃุณุฑุน (ุจุฏูู LLM filtering)
- ๐ข ุจุณุงุทุฉ: ููุงุนุฏ ูุงุถุญุฉ (ูุง black box)

---

**ุงูุชูุตูุฉ:** ุงุณุชุฎุฏุงู `SimpleLegalSearchTool` ูุฃุฏุงุฉ ุฃุณุงุณูุฉ ูุงุณุชุจุฏุงู `HybridSearchTool`.
